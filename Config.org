#+title: Emacs configuration
#+author: esedev
#+startup: overview

* =--Emacs-files---------------------------=
* early-init.el
#+name: early-init.el
#+begin_src emacs-lisp :noweb yes :tangle early-init.el
;;; early-init.el --- Emacs init script  -*- lexical-binding: t; -*-
;;; Commentary:
<<data--early-init-comment>>
;;; Code:
;;;;; debug
(when init-file-debug
  (trace-function 'require)
  (trace-function 'load)
  ;; (trace-function 'package-initialize)
  ;; (trace-function 'custom-initialize-reset)
  ;; (require 'edebug)
  ;; (edebug-trace "CFG: start early-init.el")
  )

;;;;; processing extended command line arguments with '--u-' prefix
(when t
  (require 'cl-seq)
  (let ((u-args (cl-remove-if-not
                 (lambda (e) (string-prefix-p "--u-" e))
                 command-line-args)))
    (dolist (a u-args)
      (when-let ((arg-lst (split-string a "="))
                 (opt (substring (car arg-lst) 4 nil))
                 (var (concat "EMAX_" (upcase opt)))
                 (val (car (cdr arg-lst))))
        (setenv var val)))
    (cl-delete-if (lambda (e) (string-prefix-p "--u-" e)) command-line-args)))

;;;;; initialize config variables
(defvar cfg/profile (intern (or (getenv "EMAX_PRF") "actual"))
  "User Emacs profile identity.")
(defvar cfg/job (getenv "EMAX_JOB") "Job identity, type string.")
(defvar cfg/directory user-emacs-directory "Path to config directory.")
(defvar cfg/frame-title (format "%s%s‚òÄ%s" cfg/profile
                                (if cfg/job (concat "-" cfg/job) "")
                                system-name) "Emacs frame title.")

;;;;; paths for clean and order
(defun cfg/path (arg)                   ; ~/.config/emacs/$arg
  "Return full path file ARG in `cfg/directory'."
  (expand-file-name arg cfg/directory))
(defun cfg/path-s (arg)                 ; ~/.config/emacs/save/$arg
  (cfg/path (concat "save/" arg)))

(setq user-emacs-directory (cfg/path "target"))

(defun cfg/path-u (arg)                 ; ~/.config/emacs/target/$arg
  "Return full path file ARG in `user-emacs-directory'."
  (expand-file-name arg user-emacs-directory))
(defun cfg/path-p (arg)                 ; ~/.config/emacs/target/prf--%name%/$arg
  "Return full profile path file ARG in `user-emacs-directory'."
  (cfg/path-u (format "prf--%s/%s" cfg/profile arg)))

(setq package-user-dir (cfg/path-p "elpa"))
(when (boundp 'native-comp-eln-load-path) ; set eln-cache dir
  (startup-redirect-eln-cache (cfg/path-p "eln-cache")))

(setq custom-file (cfg/path-s (format "custom-file-%s.el" cfg/profile)))

;;;;; micro tuning
;; (setq frame-title-format '( "GNU/Emacs " title))
(setq frame-title-format
      '("GNU/Emacs"
        (:eval (if tab-bar-mode
                   (concat " ___/ " (cdr (assq 'name (tab-bar--current-tab))) " \\___ ") ""))
        "<" cfg/frame-title ">"))

;;;;; performance
(setq gc-cons-threshold (* 64 1024 1024)) ; run gc after threshold
(setq read-process-output-max (* 1 1024 1024)) ; performance with language servers
(setenv "LSP_USE_PLISTS" "true") ; tree-sitter performance enhancement
;; (setq lsp-use-plists t)          ;

;;;;;
(setq package-enable-at-startup nil)    ; must be called explicitly (package-initialize)


(provide 'early-init)
;;; early-init.el ends here
#+end_src
* init.el
#+begin_src emacs-lisp :noweb yes :tangle init.el
;;; init.el --- Emacs init script  -*- lexical-binding: t; -*-

;;; Commentary:

;;; Code:
(when (< emacs-major-version 30)
  (error "Minimum required Emacs version 30, current %s" emacs-major-version))
(eval-when-compile
  (require 'use-package))
;;;;; begin of configure package manager
(use-package package
  :ensure nil
  :custom
  (package-native-compile t)
  (package-archives '(("gnu"   . "https://elpa.gnu.org/packages/")
                      ("nongnu" . "https://elpa.nongnu.org/nongnu/")
                      ("melpa-stable" . "https://stable.melpa.org/packages/")
                      ("melpa" . "https://melpa.org/packages/")))
  (package-archive-priorities '(("gnu" . 10) ("nongnu" . 9)
                                ("melpa-stable" . 7) ("melpa" . 1)))
  :config
  (package-initialize)                  ; must have
  (when (eq cfg/profile 'built-in)
      (setq package-archives nil)))
(use-package use-package
  :ensure nil
  :custom
  ;; (use-package-always-defer t)
  (use-package-minimum-reported-time 0.05)
  (use-package-verbose nil))
;;;;; end of configure package manager
;;; performance
(add-hook 'emacs-startup-hook
          (lambda ()
            (let ((mb (if (display-graphic-p) 8 1)))
              (setq gc-cons-threshold (* mb 1024 1024)))
            (message "Emacs loaded in %s seconds with %d garbage collections."
                     (emacs-init-time "%.2f") gcs-done))
          100)


<<lisp--init>>
;;; load profile
(load (cfg/path (format "init/init-%s" cfg/profile)))

(provide 'init)
;;; init.el ends here
#+end_src
* =--Profiles------------------------------=
* init/init-actual.el
#+begin_src emacs-lisp :noweb yes :tangle init/init-actual.el
;;; init-actual.el --- Default Emacs init script  -*- lexical-binding: t; -*-
<<data--copyright>>
<<data--license-gpl-v3>>
;;; Commentary:
;; This config use only good work things

;;; Code:
<<role--built-in--core>>
<<role--navi--vertico>>
<<role--emacs>>
<<role--ide-native>>

(provide 'init-actual)
;;; init-actual.el ends here
#+end_src
* init/init-built-in.el
#+begin_src emacs-lisp :noweb yes :tangle init/init-built-in.el
;;; init-built-in.el --- Minimalistic Emacs config  -*- lexical-binding: t; -*-
<<data--copyright>>
<<data--license-gpl-v3>>
;;; Commentary:
;; This config use only built-in packages

;;; Code:
<<role--built-in--core>>
<<role--built-in--ide>>

(cfg//setup--ido-mode)

(provide 'init-built-in)
;;; init-built-in.el ends here
#+end_src
* init/init-craft.el
#+begin_src emacs-lisp :noweb yes :tangle init/init-craft.el
;;; init-craft.el --- Emacs config like IDE  -*- lexical-binding: t; -*-
<<data--copyright>>
<<data--license-gpl-v3>>
;;; Commentary:
;; This config use good work things for development

;;; Code:
<<role--built-in--core>>
<<role--navi--vertico>>
<<role--emacs>>
<<role--ide-lsp>>

(killless-mode t) ; protect from accidentally closing

(provide 'init-craft)
;;; init-craft.el ends here
#+end_src
* init/init-devel.el
#+begin_src emacs-lisp :noweb yes :tangle init/init-devel.el
;;; init-devel.el --- Experimental Emacs config  -*- lexical-binding: t; -*-
<<data--copyright>>
<<data--license-gpl-v3>>
;;; Commentary:
;; This config used for experiments with emacs configuration

;;; Code:
<<role--built-in--core>>
<<role--navi--vertico>>
;; <<pckg--hydra>>
;; <<suit--emacs-editor>>
<<role--emacs>>

<<role--experimental>>
<<role--yard-of-test>>

(provide 'init-devel)
;;; init-devel.el ends here
#+end_src
* =--Lisp----------------------------------=
* lisp--init
#+name: lisp--init
#+begin_src emacs-lisp :noweb yes :results silent
<<lisp--cfg-setup>>
(cfg//setup--override-keybindings)

<<mode--killless-mode>>
;;; remap keybindings
<<bind--minor-maps>>
<<bind--major-map>>
<<bind--craft-map>>
<<bind--agile-map>>
<<mode--emax-hk-mode>>
(emax-hk-mode 1)

<<thms--initialize>>
;;; customize
<<cstm--user-env>>
(if (file-exists-p custom-file)
    (load custom-file)
  (progn
    <<cstm--default>>
    <<cstm--electric-pairs>>
    ))
<<lisp--emacs-customize>>
<<lisp--cfg-functions>>
<<lisp--emax>>
;;;
(load (cfg/path "data/help-quick-custom"))
#+end_src
* lisp--cfg-setup
#+name: lisp--cfg-setup
#+begin_src emacs-lisp :noweb yes :results silent
;;;
;;; lisp--cfg-setup
;;;
(defun cfg//setup--override-keybindings ()
  <<bind--override-standard>>
  )
(defun cfg//setup--ido-mode ()
  (ido-mode 1)
  (setf (nth 2 ido-decorations) "\n")
  (setq ido-enable-flex-matching t) ; show any name that has the chars you typed
  (setq ido-default-file-method 'selected-window) ; use current pane for newly opened file
  (setq ido-default-buffer-method 'selected-window) ; use current pane for newly switched buffer
  (setq max-mini-window-height 0.5) ; big minibuffer height, for ido to show choices vertically
  )
(defun cfg//setup--remap-major-modes ()
  (push '(ruby-mode ruby-ts-mode) major-mode-remap-alist)
  (push '(rust-mode rust-ts-mode) major-mode-remap-alist))
#+end_src
* lisp--emacs-customize
#+name: lisp--emacs-customize
#+begin_src emacs-lisp :results silent
;;;
;;; lisp--emacs-customize
;;;
(when (and (display-graphic-p (selected-frame)) (eq cfg/profile 'craft))
  (add-to-list 'initial-frame-alist '(fullscreen . maximized))
  (setopt cursor-type 'hollow))
;;; remap tree-sitter modes
(setq major-mode-remap-alist
      '((bash-mode . bash-ts-mode)
        (css-mode . css-ts-mode)
        (js2-mode . js-ts-mode)
        (json-mode . json-ts-mode)
        (typescript-mode . typescript-ts-mode)
        (python-mode . python-ts-mode)
        (yaml-mode . yaml-ts-mode)))
;;;;; hightlight line off
(dolist (m-hook '(eshell-mode-hook
                  term-mode-hook
                  shell-mode-hook))
  (add-hook m-hook (lambda () (hl-line-mode 0))))
;;;;; display-line-numbers off
(dolist (m-hook '(eshell-mode-hook
                  eww-mode-hook
                  org-mode-hook
                  minimap-sb-mode-hook
                  term-mode-hook
                  shell-mode-hook
                  treemacs-mode-hook
                  spacious-padding-mode-hook
                  w3m-mode-hook))
  (add-hook m-hook (lambda () (display-line-numbers-mode 0))))
;;;;; folding code
(add-hook 'prog-mode-hook #'hs-minor-mode)
#+end_src
* lisp--cfg-functions
#+name: lisp--cfg-functions
#+begin_src emacs-lisp :results silent
;;;
;;; lisp--cfg-functions
;;;
(defun cfg/toggle-tab-bar-headers-visible (&optional visible)
  "Show/hide headers of tab bar.
   If argument VISIBLE is nil, then toggle visible of headers.
   If argument VISIBLE <= 0, then hide headers.
   If argument VISIBLE > 0, then show headers."
  (interactive)
  (let ((tbs (if visible (if ; <
                             (> visible 0) t 100)
               (if (eq tab-bar-show t) 100 t))))
    (customize-set-variable 'tab-bar-show tbs))
  (eq tab-bar-show t))
  #+end_src
* lisp--emax
#+name: lisp--emax
#+begin_src emacs-lisp :results silent
(defun emax-sh (command)
  "Run `start-process-shell-command' with COMMAND.
NAME   set to \"sh:COMMAND\"
BUFFER set to \"bf:COMMAND\"
"
  (interactive "sCommand: ")
  (let ((name (concat "process: " command))
        (buff (concat "bash: " command)))
    (start-process-shell-command name buff command)
    (display-buffer buff)))
#+end_src
* =--Roles---------------------------------=
* role--built-in--core
#+name: role--built-in--core
#+begin_src emacs-lisp :noweb yes
;;;
;;; role--built-in--core
;;;
<<code--emacs-built-in>>
<<pckg--emacs>>
<<pckg--dired>>
<<pckg--eww>>
<<pckg--org>>
<<pckg--ruby-ts-mode>>
<<pckg--term>>
<<pckg--which-key>>
<<pckg--whitespace>>
#+end_src
* role--built-in--ide
#+name: role--built-in--ide
#+begin_src emacs-lisp :noweb yes
<<pckg--flymake>>
<<pckg--eglot>>
<<pckg--rust-ts-mode>>
(cfg//setup--remap-major-modes)
#+end_src
* =------=
* role--navi--vertico
#+name: role--navi--vertico
#+begin_src emacs-lisp :noweb yes
;;;
;;; role--navi--vertico
;;;
<<pckg--cape>>
<<pckg--consult>>
<<pckg--corfu>>
<<pckg--embark>>
<<pckg--marginalia>>
<<pckg--orderless>>
<<pckg--vertico>>
#+end_src
* role--emacs
#+name: role--emacs
#+begin_src emacs-lisp :noweb yes
;;;
;;; role--emacs
;;;
;;;;; cozy
<<pckg--hydra>>
<<pckg--yasnippet>>
<<suit--emacs-editor>>
<<suit--emacs-media>>
;;;;; org
<<pckg--org-modern>>
(use-package htmlize
  :ensure t
  :pin nongnu)
;;;;; files
;;;;; ui
<<pckg--fontaine>>
<<pckg--spacious-padding>>
<<suit--emacs-view>>
<<pckg--treemacs>>
<<suit--games>>
;;;;;
#+end_src
* role--ide-native
#+name: role--ide-native
#+begin_src emacs-lisp :noweb yes
;;;
;;; role--ide-native
;;;
<<pckg--magit>>
<<pckg--flymake>>
<<pckg--eglot>>
<<pckg--rust-ts-mode>>
<<pckg--d-mode>>
(cfg//setup--remap-major-modes)
#+end_src
* role--ide-lsp
#+name: role--ide-lsp
#+begin_src emacs-lisp :noweb yes
;;;
;;; role--ide-lsp
;;;
<<pckg--magit>>
<<suit--rustic-lsp-flycheck>>
#+end_src
* =------=
* role--experimental
#+name: role--experimental
#+begin_src emacs-lisp :noweb yes
;;;
;;; role--experimental
;;;
<<pckg--popper>>
#+end_src
* role--yard-of-test
#+name: role--yard-of-test
#+begin_src emacs-lisp :noweb yes
;;;
;;; role--yard-of-test
;;;
<<suit--rustic-lsp-flycheck>>
<<pckg--dashboard>>
#+end_src
* =------=
* role--jobs
#+name: role--jobs
#+begin_src emacs-lisp :noweb yes
;;;
;;; role--jobs
;;;
<<code--jobs>>
(if (string-equal cfg/job "assist")
    (u--do-prepare-job-assist))
#+end_src
* =--Packages------------------------------=
* =Built-in=
* pckg--dired
[^]  runs the command dired-up-directory
[C-u S] update variable dired-listing-switches
#+name: pckg--dired
#+begin_src emacs-lisp
(use-package dired
  :ensure nil
  :delight "Dir"
  :custom
  (dired-kill-when-opening-new-dired-buffer t)
  ;; (dired-omit-files "^\\..*$") ; Omit the dotfiles
  ;; (dired-omit-files "^\\.$" )
  (dired-isearch-filenames 'dwim)
  (dired-recursive-copies 'always)
  (dired-recursive-deletes 'always)
  (dired-listing-switches "-aluFh --group-directories-first -I .")
  (dired-dwim-target t)
  (delete-by-moving-to-trash t)
  ;; Auto refresh Dired, but be quiet about it
  (auto-revert-verbose nil)
  :hook
  (dired-mode . dired-hide-details-mode)
  (dired-mode . auto-revert-mode)
  ;; (dired-mode . dired-omit-mode) ; <C-x M-o> - toggle dired-omit-mode
  :config
  (put 'dired-find-alternate-file 'disabled nil))
#+end_src
* pckg--eglot
#+name: pckg--eglot
#+begin_src emacs-lisp
(use-package eglot
  :ensure nil
  :defer t
  :init
  (defun cfg//manually-activate-flymake ()
    (add-hook 'flymake-diagnostic-functions #'eglot-flymake-backend nil t)
    (flymake-mode 1))
  (defvar-keymap cfg/kmap-eglot
    :doc "lsp eglot."
    :name "Eglot menu"
    "F" 'eglot-format
    "f" 'eglot-code-action-quickfix
    "r" 'eglot-rename
    "<f12>" 'eglot-ensure)
  (keymap-set cfg-hk/craft-map "e" cfg/kmap-eglot)
  (which-key-add-key-based-replacements "C-. e" "Eglot")
  ;; :hook (eglot--managed-mode . cfg//manually-activate-flymake)
  :custom
  (eglot-autoshutdown t)
  ;; :config
  ;; (add-to-list 'eglot-stay-out-of 'flymake)
  )
#+end_src
* pckg--emacs
/Setting up *User* hotkeys/ [[*bind--interactive-user-hotkeys]]
#+name: pckg--emacs
#+begin_src emacs-lisp :noweb yes
(use-package emacs
  :ensure nil
  ;; :init
  ;; (add-to-list 'display-buffer-alist
  ;;              '("\\*rust-analyzer\\*"
  ;;                (display-buffer-in-side-window)
  ;;                (side . right)
  ;;                (slot . 0)
  ;;                (window-width . 80)
  ;;                (window-parameters (no-delete-other-windows . nil))))

  )

;; (use-package desktop
;;   :ensure nil
;;   :custom
;;   (desktop-dirname (cfg/path-u "desktop") "–ö–∞—Ç–∞–ª–æ–≥ –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è —Ñ–∞–π–ª–∞ .desktop.")
;;   ;; (desktop-load-locked-desktop t "–ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–∞–π–ª–∞ .desktop –¥–∞–∂–µ –µ—Å–ª–∏ –æ–Ω –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω.")
;;   (desktop-restore-frames t "–í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—Ç—å —Ñ—Ä–µ–π–º—ã.")
;;   (desktop-save t "–°–æ—Ö—Ä–∞–Ω—è—Ç—å —Å–ø–∏—Å–æ–∫ –æ—Ç–∫—Ä—ã—Ç—ã—Ö –±—É—Ñ–µ—Ä–æ–≤, —Ñ–∞–π–ª–æ–≤ –∏ —Ç. –¥. –±–µ–∑ –ª–∏—à–Ω–∏—Ö –≤–æ–ø—Ä–æ—Å–æ–≤.")
;;   ;; :hook (after-init . desktop-read)
;;   :config
;;   ;; (desktop-save-mode t)
;;   ;; (add-to-list 'delete-frame-functions 'desktop-save)
;;   (add-to-list 'desktop-modes-not-to-save 'dired-mode))
#+end_src
* pckg--eww
#+name: pckg--eww
#+begin_src emacs-lisp
(use-package eww
  :ensure nil
  :defer t
  :preface
  (defun eww-render-buffer ()
    "Render the current buffer in EWW."
    (interactive)
    (let* ((html (buffer-substring-no-properties (point-min) (point-max)))
           (source (buffer-name))
           (buf (generate-new-buffer (concat "eww: " source))))
      (with-current-buffer buf
        (insert html)
        (goto-char (point-min))
        (eww-display-html 'utf-8 source nil (point-min) buf))
      (switch-to-buffer buf)))
  :config
  (setq eww-search-prefix "https://lite.duckduckgo.com/lite/?q=")
  (keymap-set cfg-hk/open-shelf-map "<f2>"
              '("–†—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ GNU Emacs" .
                (lambda ()(interactive)(eww "https://alexott.net/ru/emacs/emacs-manual/"))))
  (keymap-set cfg-hk/open-shelf-map "<f3>"
              `("–ü–æ–∏—Å–∫ –≤ —Å–µ—Ç–∏" .
                (lambda ()(interactive)(eww "https://lite.duckduckgo.com/lite"))))
  (keymap-set cfg-hk/open-shelf-map "<f4>"
              '("eww: —Ç–µ–∫—É—â–∏–π –±—É—Ñ–µ—Ä" .
                eww-render-buffer)))
#+end_src
* pckg--flymake
#+name: pckg--flymake
#+begin_src emacs-lisp
(use-package flymake
  :ensure nil
  :custom
  (flymake-no-changes-timeout 1.2))
  ;; :hook((emacs-lisp-mode . flymake-mode)))
#+end_src
* pckg--org
#+name: pckg--org
#+begin_src emacs-lisp
(use-package org
  :ensure nil
  :pin manual
  :defer t
  :hook  (org-mode . cfg//hook--org-mode)
  :init
  (defun cfg//hook--org-mode ()
    "Minor modes tunning."
    (org-indent-mode 1)
    (variable-pitch-mode 0)
    (visual-line-mode 1))
  (keymap-set cfg-hk/open-entities-map "a" '("agenda" . org-agenda))
  (keymap-set cfg-hk/open-entities-map "s" '("schedule" . org-agenda-list))
  :bind-keymap
  ("C-c o" . org-mode-map)
  :custom
  (org-directory (cfg/org ""))
  (org-startup-folded 'overview)
  (org-edit-src-content-indentation 0)
  (org-agenda-current-time-string "‚Üê now ‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî ‚ò¢")
  (org-ellipsis "..‚ØÜ") ; ‚Æã‚Æß‚Æ∑‚ØÜ‚á≤‚Ü¥‚ñæ
  (org-hide-emphasis-markers t)
  (org-startup-with-inline-images t) ; show inline images
  (org-return-follows-link t) ; follow by links of RET
  (org-todo-keywords
   '((sequence "TODO(t)" "WORK(g)" "WAIT(w)" "HOLD(h)" "|" "DONE(d)" "KILL(k)")))
  ;; agenda
  (org-agenda-files (list (concat org-directory "/agenda")))
  (org-confirm-babel-evaluate nil)
  :config
  (add-to-list 'org-src-lang-modes
               (cons "D" 'd)
               (cons "conf-unix" 'conf-unix))
  ;; (setq org-confirm-babel-evaluate nil)
  (org-babel-do-load-languages
   'org-babel-load-languages
   '((emacs-lisp . t)
     (C . t)
     (shell . t)
     (ruby . t)
     (python . t)))
  (which-key-add-key-based-replacements "C-c o" "Org")
  (which-key-add-major-mode-key-based-replacements 'org-mode
    "C-c \"" "Org plot" ; \"
    "C-c C-v" "Org babel"
    "C-c C-x" "Org X"))
#+end_src
* pckg--ruby-ts-mode
#+name: pckg--ruby-ts-mode
#+begin_src emacs-lisp :results silent
(use-package ruby-ts-mode
  :ensure nil
  :delight "R‚úßby"
  :mode "\\.rb\\'"
  :mode "config.ru\\'"
  :mode "Rakefile\\'"
  :mode "Gemfile\\'"
  :mode "Vagrantfile\\'"
  :interpreter "ruby"
  :bind (:map ruby-ts-mode-map
              ("C-c r b" . 'treesit-beginning-of-defun)
              ("C-c r e" . 'treesit-end-of-defun))
  :hook (ruby-base-mode . subword-mode)
  :custom (ruby-indent-level 2)
          (ruby-indent-tabs-mode nil))
#+end_src
* pckg--rust-ts-mode
#+name: pckg--rust-ts-mode
#+begin_src emacs-lisp :results silent
(use-package rust-ts-mode
  :ensure nil
  :delight "R‚úßst"
  :mode "\\.rs\\'"
  :hook
  (rust-ts-mode . eglot-ensure))
#+end_src
* pckg--term
#+name: pckg--term
#+begin_src emacs-lisp :results silent
(use-package term
  :ensure nil
  :commands term
  :config
  ;; Match the default Bash shell prompt.  Update this if you have a custom prompt
  ;;(setq explicit-zsh-args '())         ; Use 'explicit-<shell>-args for shell-specific args
  ;; (setq explicit-shell-file-name "bash") ; Change this to zsh, etc
  (setq term-prompt-regexp "^[^#$%>\n]*[#$%>Œª] *"))
#+end_src
* pckg--which-key
#+name: pckg--which-key
#+begin_src emacs-lisp
(use-package which-key
  :ensure nil
  :delight
  :hook (emacs-startup . which-key-mode)
  :config
  (setq which-key-idle-delay 0.4)
  (setq which-key-idle-secondary-delay 0.05)
  (setq which-key-min-display-lines 4)

  ;; (add-to-list 'which-key-replacement-alist '(("TAB" . nil) . ("‚Üπ" . nil)))
  ;; (add-to-list 'which-key-replacement-alist '(("RET" . nil) . ("‚èé" . nil)))
  ;; (add-to-list 'which-key-replacement-alist '(("DEL" . nil) . ("‚á§" . nil)))
  ;; (add-to-list 'which-key-replacement-alist '(("SPC" . nil) . ("‚ê£" . nil)))

  (which-key-add-key-based-replacements "C-c @" "ShowHide")
  (which-key-add-key-based-replacements "C-c e" "IDE")

  (which-key-add-major-mode-key-based-replacements 'rust-mode
    "C-c C-c" "Rust")
  (which-key-add-key-based-replacements "C-c p" "Cape")
  (which-key-add-key-based-replacements "C-x RET" "coding system")
  (which-key-add-key-based-replacements "C-x a" "abbrev")
  (which-key-add-key-based-replacements "C-x n" "narrow")
  (which-key-add-key-based-replacements "C-x p" "project")
  (which-key-add-key-based-replacements "C-x r" "register")
  (which-key-add-key-based-replacements "C-x t" "tab")
  (which-key-add-key-based-replacements "C-x v" "version ctrl")
  (which-key-add-key-based-replacements "C-x w" "window")
  (which-key-add-key-based-replacements "C-x x" "misc")
  (which-key-add-key-based-replacements "C-x 8" '("unicode" . "Unicode keys"))
  (which-key-add-key-based-replacements "C-x 8 e" "emoji"))
#+end_src
* pckg--whitespace
#+name: pckg--whitespace
#+begin_src emacs-lisp
(use-package whitespace
  :ensure nil
  :config
  (setq whitespace-display-mappings
        '((space-mark 32
                      [183]
                      [46])
          (space-mark 160
                      [164]
                      [95])
          (newline-mark 10
                        [172 10])
          ;; (newline-mark 10 [36 10]))
          (tab-mark 9
                    [187 9]
                    [92 9])))
  ;; delete trailing whitespaces when save buffer
  (add-to-list 'write-file-functions 'delete-trailing-whitespace))
#+end_src
* =Repository=
* pckg--cape
#+name: pckg--cape
#+begin_src emacs-lisp
(use-package cape
  :ensure t
  :pin gnu
  ;; Bind dedicated completion commands
  ;; Alternative prefix keys: C-c p, M-p, M-+, ...
  :bind (("C-c p p" . completion-at-point) ;; capf
	 ("C-c p t" . complete-tag)        ;; etags
	 ("C-c p d" . cape-dabbrev)        ;; or dabbrev-completion
	 ("C-c p h" . cape-history)
	 ("C-c p f" . cape-file)
	 ("C-c p k" . cape-keyword)
	 ("C-c p s" . cape-elisp-symbol)
	 ("C-c p e" . cape-elisp-block)
	 ("C-c p a" . cape-abbrev)
	 ("C-c p l" . cape-line)
	 ("C-c p w" . cape-dict)
	 ("C-c p :" . cape-emoji)
	 ("C-c p \\" . cape-tex)
	 ("C-c p _" . cape-tex)
	 ("C-c p ^" . cape-tex)
	 ("C-c p &" . cape-sgml)
	 ("C-c p r" . cape-rfc1345)
     ;; ("M-;" . completion-at-point)
     )
  :init
  ;; Add to the global default value of `completion-at-point-functions' which is
  ;; used by `completion-at-point'.  The order of the functions matters, the
  ;; first function returning a result wins.  Note that the list of buffer-local
  ;; completion functions takes precedence over the global list.
  (add-to-list 'completion-at-point-functions #'cape-dabbrev)
  (add-to-list 'completion-at-point-functions #'cape-file)
  (add-to-list 'completion-at-point-functions #'cape-elisp-block)
  ;;(add-to-list 'completion-at-point-functions #'cape-history)
  ;;(add-to-list 'completion-at-point-functions #'cape-keyword)
  ;;(add-to-list 'completion-at-point-functions #'cape-tex)
  ;;(add-to-list 'completion-at-point-functions #'cape-sgml)
  ;;(add-to-list 'completion-at-point-functions #'cape-rfc1345)
  (add-to-list 'completion-at-point-functions #'cape-abbrev)
  (add-to-list 'completion-at-point-functions #'cape-dict)
  ;;(add-to-list 'completion-at-point-functions #'cape-elisp-symbol)
  ;;(add-to-list 'completion-at-point-functions #'cape-line)
)
#+end_src
* pckg--consult
#+name: pckg--consult
#+begin_src emacs-lisp
;; Example configuration for Consult
(use-package consult
  :ensure t
  :pin gnu
  ;; Replace bindings. Lazily loaded due by `use-package'.
  :bind (;; C-c bindings in `mode-specific-map'
	 ("C-c M-x" . consult-mode-command)
	 ("C-c h" . consult-history)
	 ("C-c k" . consult-kmacro)
	 ("C-c m" . consult-man)
	 ("C-c i" . consult-info)
     ("C-s" . consult-line)
	 ([remap Info-search] . consult-info)
	 ;; C-x bindings in `ctl-x-map'
	 ("C-x M-:" . consult-complex-command)     ;; orig. repeat-complex-command
	 ("C-x b" . consult-buffer)                ;; orig. switch-to-buffer
	 ("C-x 4 b" . consult-buffer-other-window) ;; orig. switch-to-buffer-other-window
	 ("C-x 5 b" . consult-buffer-other-frame)  ;; orig. switch-to-buffer-other-frame
	 ("C-x t b" . consult-buffer-other-tab)    ;; orig. switch-to-buffer-other-tab
	 ("C-x r b" . consult-bookmark)            ;; orig. bookmark-jump
	 ("C-x p b" . consult-project-buffer)      ;; orig. project-switch-to-buffer
	 ;; Custom M-# bindings for fast register access
	 ("M-#" . consult-register-load)
	 ("M-'" . consult-register-store)          ;; orig. abbrev-prefix-mark (unrelated)
	 ("C-M-#" . consult-register)
	 ;; Other custom bindings
	 ("M-y" . consult-yank-pop)                ;; orig. yank-pop
	 ;; M-g bindings in `goto-map'
	 ("M-g e" . consult-compile-error)
	 ("M-g f" . consult-flymake)               ;; Alternative: consult-flycheck
	 ("M-g g" . consult-goto-line)             ;; orig. goto-line
	 ("M-g M-g" . consult-goto-line)           ;; orig. goto-line
	 ("M-g o" . consult-outline)               ;; Alternative: consult-org-heading
	 ("M-g m" . consult-mark)
	 ("M-g k" . consult-global-mark)
	 ("M-g i" . consult-imenu)
	 ("M-g I" . consult-imenu-multi)
	 ;; M-s bindings in `search-map'
	 ("M-s d" . consult-find)                  ;; Alternative: consult-fd
	 ("M-s c" . consult-locate)
	 ("M-s g" . consult-grep)
	 ("M-s G" . consult-git-grep)
	 ("M-s r" . consult-ripgrep)
	 ("M-s l" . consult-line)
	 ("M-s L" . consult-line-multi)
	 ("M-s k" . consult-keep-lines)
	 ("M-s u" . consult-focus-lines)
	 ;; Isearch integration
	 ("M-s e" . consult-isearch-history)
	 :map isearch-mode-map
	 ("M-e" . consult-isearch-history)         ;; orig. isearch-edit-string
	 ("M-s e" . consult-isearch-history)       ;; orig. isearch-edit-string
	 ("M-s l" . consult-line)                  ;; needed by consult-line to detect isearch
	 ("M-s L" . consult-line-multi)            ;; needed by consult-line to detect isearch
	 ;; Minibuffer history
	 :map minibuffer-local-map
	 ("M-s" . consult-history)                 ;; orig. next-matching-history-element
	 ("M-r" . consult-history))                ;; orig. previous-matching-history-element

  ;; Enable automatic preview at point in the *Completions* buffer. This is
  ;; relevant when you use the default completion UI.
  :hook (completion-list-mode . consult-preview-at-point-mode)

  ;; The :init configuration is always executed (Not lazy)
  :init
  ;; Optionally configure the register formatting. This improves the register
  ;; preview for `consult-register', `consult-register-load',
  ;; `consult-register-store' and the Emacs built-ins.
  (setq register-preview-delay 0.5
	register-preview-function #'consult-register-format)
  ;; Optionally tweak the register preview window.
  ;; This adds thin lines, sorting and hides the mode line of the window.
  (advice-add #'register-preview :override #'consult-register-window)
  ;; Use Consult to select xref locations with preview
  (setq xref-show-xrefs-function #'consult-xref
	xref-show-definitions-function #'consult-xref)
  ;; Configure other variables and modes in the :config section,
  ;; after lazily loading the package.
  :config
  ;; Optionally configure preview. The default value
  ;; is 'any, such that any key triggers the preview.
  ;; (setq consult-preview-key 'any)
  ;; (setq consult-preview-key "M-.")
  ;; (setq consult-preview-key '("S-<down>" "S-<up>"))
  ;; For some commands and buffer sources it is useful to configure the
  ;; :preview-key on a per-command basis using the `consult-customize' macro.
  (consult-customize
   consult-theme :preview-key '(:debounce 0.2 any)
   consult-ripgrep consult-git-grep consult-grep
   consult-bookmark consult-recent-file consult-xref
   ;; ERR: consult--source-bookmark is neither a Command command nor a source
   ;; consult--source-bookmark consult--source-file-register
   ;; consult--source-recent-file consult--source-project-recent-file
   ;; :preview-key "M-."
   :preview-key '(:debounce 0.4 any))
  ;; Optionally configure the narrowing key.
  ;; Both < and C-+ work reasonably well.
  (setq consult-narrow-key "<") ;; "C-+"
  ;; Optionally make narrowing help available in the minibuffer.
  ;; You may want to use `embark-prefix-help-command' or which-key instead.
  ;; (define-key consult-narrow-map (vconcat consult-narrow-key "?") #'consult-narrow-help)

  ;; By default `consult-project-function' uses `project-root' from project.el.
  ;; Optionally configure a different project root function.
  ;;;; 1. project.el (the default)
  ;; (setq consult-project-function #'consult--default-project--function)
  ;;;; 2. vc.el (vc-root-dir)
  ;; (setq consult-project-function (lambda (_) (vc-root-dir)))
  ;;;; 3. locate-dominating-file
  ;; (setq consult-project-function (lambda (_) (locate-dominating-file "." ".git")))
  ;;;; 4. projectile.el (projectile-project-root)
  ;; (autoload 'projectile-project-root "projectile")
  ;; (setq consult-project-function (lambda (_) (projectile-project-root)))
  ;;;; 5. No project support
  ;; (setq consult-project-function nil)
)
#+end_src
* pckg--corfu
#+name: pckg--corfu
#+begin_src emacs-lisp
(use-package corfu                      ; popup window for autocomplete
  :ensure t
  :pin gnu
  :custom
  (corfu-cycle t)                ;; Enable cycling for `corfu-next/previous'
  (corfu-auto t)                 ;; Enable auto completion
  (corfu-auto-delay 0.3)
  ;; (corfu-separator ?\s)          ;; Orderless field separator
  ;; (corfu-quit-at-boundary nil)   ;; Never quit at completion boundary
  ;; (corfu-quit-no-match nil)      ;; Never quit, even if there is no match
  ;; (corfu-preview-current nil)    ;; Disable current candidate preview
  ;; (corfu-preselect 'prompt)      ;; Preselect the prompt
  ;; (corfu-on-exact-match nil)     ;; Configure handling of exact matches
  ;; (corfu-scroll-margin 5)        ;; Use scroll margin

  ;; Enable Corfu only for certain modes.
  ;; :hook ((prog-mode . corfu-mode)
  ;;        (shell-mode . corfu-mode)
  ;;        (eshell-mode . corfu-mode))

  ;; Recommended: Enable Corfu globally.  This is recommended since Dabbrev can
  ;; be used globally (M-/).  See also the customization variable
  ;; `global-corfu-modes' to exclude certain modes.
  :init
  (global-corfu-mode))
#+end_src
* pckg--dashboard
#+name: pckg--dashboard
#+begin_src emacs-lisp :results silent
(use-package dashboard                  ; melpa-stable
  :ensure t
  :config
  (setq dashboard-banner-logo-title "(or Dev Die)")
  (setq dashboard-startup-banner 2)
  (setq dashboard-projects-backend 'project-el)
  (setq dashboard-items '((recents . 5)
                          (bookmarks . 5)
                          (projects  . 5)
                          (agenda    . 5)
                          (registers . 5)))
  ;; (when (display-graphic-p)
  (setq dashboard-icon-type 'all-the-icons)
  (setq dashboard-heading-icons '((recents   . "history")
                                  (bookmarks . "bookmark")
                                  (agenda    . "calendar")
                                  (projects  . "rocket")
                                  (registers . "database")))
  (setq dashboard-set-heading-icons t)
  (setq dashboard-set-file-icons t)
    ;; )

  (add-hook 'server-after-make-frame-hook 'dashboard-open)
  (dashboard-setup-startup-hook))
#+end_src
* pckg--d-mode
#+name: pckg--d-mode
#+begin_src emacs-lisp
(use-package d-mode
  :delight "(D)"
  :mode ("\\.d\\'" . d-mode)
  :interpreter "rdmd"
  :init
  (with-eval-after-load 'eglot
    (add-to-list 'eglot-server-programs
                 '(d-mode . ("serve-d")))))
#+end_src
* pckg--embark
#+name: pckg--embark
#+begin_src emacs-lisp
(use-package embark
  :ensure t
  :pin gnu
  :bind (("C-h B" . embark-bindings)
         :map cfg-hk/major-map
         ("a" . embark-act)
         :map cfg-hk/agile-map
         ("a" . embark-act)
         ("M-;" . embark-dwim))
  :init
  ;; Optionally replace the key help with a completing-read interface
  (setq prefix-help-command #'embark-prefix-help-command)

  ;; Show the Embark target at point via Eldoc. You may adjust the
  ;; Eldoc strategy, if you want to see the documentation from
  ;; multiple providers. Beware that using this can be a little
  ;; jarring since the message shown in the minibuffer can be more
  ;; than one line, causing the modeline to move up and down:

  ;; (add-hook 'eldoc-documentation-functions #'embark-eldoc-first-target)
  ;; (setq eldoc-documentation-strategy #'eldoc-documentation-compose-eagerly)

  :config

  ;; Hide the mode line of the Embark live/completions buffers
  (add-to-list 'display-buffer-alist
	       '("\\`\\*Embark Collect \\(Live\\|Completions\\)\\*"
		 nil
		 (window-parameters (mode-line-format . none)))))
(use-package embark-consult
  :ensure t
  :pin gnu
  :requires (embark consult)
  :after (embark consult)
  :hook
  (embark-collect-mode . consult-preview-at-point-mode))
#+end_src
* pckg--fontaine
#+name: pckg--fontaine
#+begin_src emacs-lisp :noweb yes
(use-package fontaine
  :ensure t
  :pin gnu
  :defer t
  :if (display-graphic-p)
  :init
  (keymap-set cfg-hk/update-ui-map "f" '("fontaine" . fontaine-set-preset))
  :config
  (setq fontaine-presets
        '((regular)
          (code
           :default-family "Source Code Pro"
           :default-weight normal)
          (code-small
           :inherit code
           :default-height 80)
          (code-large
           :inherit code
           :default-height 160
           :variable-pitch-height 1.0
           :tab-bar-height 0.9)
          (educational-board
           :default-family "Roboto Regular"
           :default-height 240
           :variable-pitch-height 1.0
           :tab-bar-height 0.7)
          (t
           <<font--preset-t>>
           )
          ))
  (setq frame-inhibit-implied-resize t)
  (fontaine-set-preset 'regular)
  (add-hook 'enable-theme-functions #'fontaine-apply-current-preset)
  (fontaine-mode 1)
  )
#+end_src
** font--preset-default
#+name: font--preset-t
#+begin_src emacs-lisp :results silent
;; <https://protesilaos.com/emacs/fontaine>.
:default-family "Adwaita Mono Regular"
:default-weight regular :default-slant normal :default-width normal
:default-height 120
:fixed-pitch-family "Adwaita Mono Regular" :fixed-pitch-weight nil
:fixed-pitch-slant nil :fixed-pitch-width nil :fixed-pitch-height 1.0 :fixed-pitch-serif-family nil :fixed-pitch-serif-weight nil
:fixed-pitch-serif-slant nil :fixed-pitch-serif-width nil
:fixed-pitch-serif-height 1.0 :variable-pitch-family "Sans"
:variable-pitch-weight nil :variable-pitch-slant nil
:variable-pitch-width nil :variable-pitch-height 1.0
:mode-line-active-family nil :mode-line-active-weight nil
:mode-line-active-slant nil :mode-line-active-width nil
:mode-line-active-height 1.0 :mode-line-inactive-family nil
:mode-line-inactive-weight nil :mode-line-inactive-slant nil
:mode-line-inactive-width nil :mode-line-inactive-height 1.0
:header-line-family nil :header-line-weight nil :header-line-slant nil :header-line-width nil :header-line-height 1.0
:line-number-family nil :line-number-weight nil :line-number-slant nil :line-number-width nil :line-number-height 1.0 :tab-bar-family nil :tab-bar-weight nil :tab-bar-slant nil :tab-bar-width nil
:tab-bar-height 1.0 :tab-line-family nil :tab-line-weight nil
:tab-line-slant nil :tab-line-width nil :tab-line-height 1.0
:bold-family nil :bold-slant nil :bold-weight bold :bold-width nil
:bold-height 1.0 :italic-family nil :italic-weight nil
:italic-slant italic :italic-width nil :italic-height 1.0
:line-spacing nil
    #+end_src
* pckg--hydra
/Setting up hotkeys for Hydra/ [[*bind--hydra-hotkeys]]
#+name: pckg--hydra
#+begin_src emacs-lisp :noweb yes
(use-package hydra ; short bindings with a common prefix (GNU)
  :ensure t
  :pin gnu
  :demand t
  :config
  <<bind--hydra-hotkeys>>
)
#+end_src
* pckg--magit
#+name: pckg--magit
#+begin_src emacs-lisp
(use-package magit
  :ensure t
  :pin nongnu
  :defer t
  :custom
  (magit-display-buffer-function #'magit-display-buffer-same-window-except-diff-v1))
#+end_src
* pckg--markdown-mode
#+name: pckg--markdown-mode
#+begin_src emacs-lisp
(use-package markdown-mode
  :ensure t
  :pin nongnu
  :commands (markdown-mode gfm-mode)
  :mode
  ("README.*\\.md\\'" . gfm-mode)
  ("\\.md\\'" . markdown-mode)
  ("\\.markdown\\'" . markdown-mode)
  :hook
  (markdown-mode . variable-pitch-mode)
  (markdown-mode . yas-minor-mode)
  :custom
  (markdown-command "pandoc")
  (markdown-header-scaling t)
  :config
  (unbind-key "DEL" gfm-mode-map))
#+end_src
* pckg--marginalia
#+name: pckg--marginalia
#+begin_src emacs-lisp
(use-package marginalia
  :ensure t
  :pin gnu
  :config
  (marginalia-mode 1))
#+end_src
* pckg--orderless
#+name: pckg--orderless
#+begin_src emacs-lisp
(use-package orderless
  :ensure t
  :pin gnu
  :custom
  (completion-styles '(orderless basic))
  (completion-category-defaults nil)
  (completion-category-overrides '((file (styles basic partial-completion)))))
#+end_src
* pckg--org-modern
#+name: pckg--org-modern
#+begin_src emacs-lisp
(use-package org-modern
  :ensure t
  :pin gnu
  :if (display-graphic-p)
  :after org
  :custom
  (org-modern-replace-stars "‚óâ‚óã‚ú¶‚úß‚ñ™‚ñ´¬∫") ; ‚óâ‚óã‚ú¶‚úß‚ñ™‚ñ´¬∫ ‚¶ø‚óé‚óâ‚óã‚ú≥
  (org-modern-star 'replace)
  :config
  ;; Option 1: Per buffer
  (add-hook 'org-mode-hook #'org-modern-mode)
  (add-hook 'org-agenda-finalize-hook #'org-modern-agenda)
  ;; Option 2: Globally
  ;; (with-eval-after-load 'org (global-org-modern-mode))
  )
#+end_src
* pckg--popper
#+name: pckg--popper
#+begin_src emacs-lisp :results silent
(use-package popper
  :ensure t
  :pin gnu
  :bind (:map cfg-hk/agile-map
              ("C-;"   . popper-toggle)
              ("SPC k"   . popper-kill-latest-popup)
              ("RET" . popper-toggle-type))
  :init
  (setq popper-reference-buffers
        '("\\*Messages\\*"
          "Output\\*$"
          "\\*Async Shell Command\\*"
          "\\*Compile-Log\\*"
          help-mode
          emacs-lisp-compilation-mode
          flycheck-error-message-mode
          compilation-mode))
  (popper-mode +1)
  (popper-echo-mode +1))                ; For echo area hints
#+end_src
* pckg--spacious-padding
#+name: pckg--spacious-padding
#+begin_src emacs-lisp
(use-package spacious-padding
  :ensure t
  :pin gnu
  :defer t
  :if (display-graphic-p)
  :init
  (keymap-set cfg-hk/update-ui-map "p" '("paddings" . spacious-padding-mode))
  :config
  (setq spacious-padding-subtle-mode-line nil)
  ;; (setq spacious-padding-subtle-mode-line
  ;;     '(:mode-line-active error :mode-line-inactive shadow))
  ;; (setq spacious-padding-subtle-mode-line
  ;;     '(:mode-line-active "#0000ff" :mode-line-inactive "gray50"))
  (setq spacious-padding-widths
        '( :internal-border-width 20
           :header-line-width 10
           :mode-line-width 6
           :tab-width 4
           :right-divider-width 30
           :scroll-bar-width 8
           :fringe-width 8)))
#+end_src
* pckg--treemacs
#+name: pckg--treemacs
#+begin_src emacs-lisp :results silent
(use-package treemacs
  :ensure t
  :requires (ace-window hydra)
  :after (ace-window hydra)
  :defer t
  :init
  (use-package treemacs-all-the-icons
    :ensure t
    :requires (treemacs all-the-icons)
    :if (display-graphic-p)
    )
  :bind (:map cfg-hk/agile-map
              ("t" . treemacs)
              ("C-t" . treemacs-select-window))
  :custom
  (treemacs-show-hidden-files t)
  (treemacs-persist-file (cfg/path-u ".cache/treemacs-persist"))
  :config
  (treemacs-follow-mode t)
  (treemacs-filewatch-mode t)
  (treemacs-fringe-indicator-mode nil)
  (treemacs-git-mode 'simple)
  (treemacs-hide-gitignored-files-mode t)
  (treemacs-project-follow-mode t)
  (treemacs-filewatch-mode t)

  (which-key-add-key-based-replacements "C-c C-p" "treemacs prj")
  (which-key-add-key-based-replacements "C-c C-p c" "collapse")
  (which-key-add-key-based-replacements "C-c C-w" "treemacs wsp"))
(use-package treemacs-magit
  :ensure t
  :defer t
  :after (treemacs magit)
  :requires (treemacs magit)
  )
#+end_src
* pckg--web-mode
#+name: pckg--web-mode
#+begin_src emacs-lisp
(use-package web-mode
  :disabled
  :pin nongnu
  ;; :commands (web-mode)
  :mode
  ("\\.html?\\'" . web-mode)
  ("\\.css\\'" . web-mode)
  ("\\.erb\\'" . web-mode)
  ;; :hook
  ;; (web-mode . company-mode)
  ;; (web-mode . u-hook--web-mode-setup)
  :custom
  (web-mode-enable-css-colorization t)
  (web-mode-enable-engine-detection nil)
  (web-mode-code-indent-offset 2)
  (web-mode-markup-indent-offset 2)
  (web-mode-script-padding 2)
  (web-mode-css-indent-offset 2)
  (web-mode-style-padding 2)
  (put 'web-mode-engine 'safe-local-variable #'stringp)
  (put 'web-mode-engines-alist 'safe-local-variable #'listp))
#+end_src
* pckg--vertico
#+name: pckg--vertico
#+begin_src emacs-lisp
(use-package vertico
  :ensure t
  :config
  ;; Different scroll margin
  ;; (setq vertico-scroll-margin 0)
  ;; Show more candidates
  (setq vertico-count 12)
  ;; Grow and shrink the Vertico minibuffer
  (setq vertico-resize t)
  ;; Optionally enable cycling for `vertico-next' and `vertico-previous'.
  (setq vertico-cycle t)
  (keymap-set vertico-map "C-l" #'vertico-exit)
  (vertico-mode 1))
(use-package vertico-multiform
  :ensure nil
  :config
  (setq vertico-multiform-categories
        '((file grid reverse)
          (consult-location buffer)
          (consult-grep buffer)
          (minor-mode reverse)
          (imenu buffer)
          (emax-sh buffer)
          (t unobtrusive)))
  (setq vertico-multiform-commands '((consult-line (:not posframe))
                                     (t posframe)))
  :hook (after-init . vertico-multiform-mode))
(use-package posframe :ensure t)
(use-package vertico-posframe
  :ensure t
  :requires (vertico posframe)
  :after vertico
  :custom
  (vertico-posframe-parameters '((left-fringe . 8) (right-fringe . 8))))

  #+end_src
* pckg--yasnippet
#+name: pckg--yasnippet
#+begin_src emacs-lisp
(use-package yasnippet
  :ensure t
  :pin gnu
  :delight (yas-minor-mode " Ya")
  :defer t
  :init
  (use-package yasnippet-snippets
    :ensure t
    :pin nongnu
    :requires yasnippet
    :after yasnippet
    )
  :config
  (setq yas-snippet-dirs
      (list (cfg/path "data/snippets") ; personal snippets
            yasnippet-snippets-dir
        ))
  (yas-reload-all)
  (which-key-add-key-based-replacements "C-c &" "Yas")
  :hook ((prog-mode LaTeX-mode org-mode) . yas-minor-mode)
  )
#+end_src
* =Suits=
* suit--emacs-editor
#+name: suit--emacs-editor
#+begin_src emacs-lisp
(use-package ace-window
  :ensure t
  :pin gnu
  :config
  (keymap-global-set "M-o" 'ace-window)
  (setq aw-dispatch-always t)
  )
(use-package delight :ensure t :pin gnu)
(use-package golden-ratio ; auto resize window by golden ratio
  :ensure t
  :pin nongnu
  :delight "GdR"
  ;; :hook (after-init . golden-ratio-mode)
  :custom
  (golden-ratio-exclude-modes '(occur-mode))
  :config
  (with-eval-after-load "which-key"
    (add-to-list 'golden-ratio-inhibit-functions
                 (lambda ()
                   (and which-key--buffer
                        (window-live-p (get-buffer-window which-key--buffer))))))
  (keymap-global-set "C-x #" 'golden-ratio))
(use-package move-text                  ; melpa-stable
  :ensure t                             ; Using the prefix (C-u *number* or META *number*)
  :demand t                             ; you can predefine how many lines move-text will travel.
  :config (move-text-default-bindings))
(use-package rainbow-mode ; colorize color names in buffers
  :ensure t
  :pin gnu
  ;; :delight
  :hook (prog-mode . rainbow-mode))
(use-package rainbow-delimiters                ; highlight brackets according
  :ensure t
  :pin nongnu
  :hook (prog-mode . rainbow-delimiters-mode)) ; to their depth
#+end_src
* suit--emacs-media
#+name: suit--emacs-media
#+begin_src emacs-lisp :results silent
(use-package emms                       ; emacs multimedia service
  :ensure t
  :pin gnu
  :defer t)
;; (use-package gt)   ; language translator
(use-package nov                        ; epub reader
  :ensure t
  :pin nongnu
  :defer t
  :mode ("\\.epub\\'". nov-mode))
(use-package tmr                        ; timers
  :ensure t
  :pin gnu
  :defer t
  :init
  (keymap-set cfg-hk/open-entities-map "t" '("timers" . tmr-tabulated-view))
  :config
  (setq tmr-sound-file (cfg/path "data/sound/alert.ogg")))
#+end_src
* suit--emacs-view
#+name: suit--emacs-view
#+begin_src emacs-lisp :results silent
(use-package all-the-icons
  :ensure t
  :if (display-graphic-p)
  )
(use-package all-the-icons-dired
  :ensure t
  :if (display-graphic-p)
  :hook (dired-mode . all-the-icons-dired-mode))
(use-package ef-themes
  :ensure t
  :pin gnu)
#+end_src
* suit--file-extensions
#+name: suit--file-extensions
#+begin_src emacs-lisp
(use-package csv-mode
  :ensure t
  :pin gnu
  :mode "\\.[Cc][Ss][Vv]\\'")
(use-package dockerfile-mode
  :ensure t
  :pin nongnu
  )
(use-package just-mode                  ; melpa-stable
  :ensure t)
(use-package yaml-mode
  :ensure t
  :pin nongnu
  :mode "\\.ya?ml\\'"
  :hook
  (yaml-mode . highlight-indentation-mode)
  :bind
  (:map
   yaml-mode-map
   (">" . nil)))
#+end_src
* suit--games
#+name: suit--games
#+begin_src emacs-lisp :results silent
(use-package mines
  :ensure t
  :pin gnu
  :defer t)
(use-package fireplace                  ; melpa-stable
  :ensure t
  :defer t)
(use-package 2048-game                  ; melpa
  :ensure t
  :defer t)
#+end_src
* suit--rustic-lsp-flycheck
#+name: suit--rustic-lsp-flycheck
#+begin_src emacs-lisp :results silent
(use-package flycheck
  :ensure t
  :hook (after-init . global-flycheck-mode)
  :config
  (keymap-set cfg-hk/craft-map "f" flycheck-command-map)
  (which-key-add-key-based-replacements "C-c !" "Flycheck")
  (which-key-add-key-based-replacements "C-. f" "Flycheck"))
(use-package lsp-mode
  :ensure t
  :init
  (defun cfg//lsp-mode-setup ()
    (keymap-set cfg-hk/craft-map "C-." '("doc glance" . lsp-ui-doc-glance))
    (keymap-set cfg-hk/craft-map "i" '("imenu" . lsp-ui-imenu)))
  :hook (lsp-mode . cfg//lsp-mode-setup)
  :custom (lsp-keymap-prefix "C-c l")
  )
(use-package consult-lsp :ensure t)     ; melpa-stable
(with-eval-after-load 'lsp-mode
  (add-hook 'lsp-mode-hook #'lsp-enable-which-key-integration))
(use-package lsp-treemacs
  :ensure t
  :requires (lsp-mode treemacs)
  :after lsp-mode)
(use-package lsp-ui
  :ensure t
  :requires lsp-mode)
(use-package rust-mode
  :ensure t
  :init
  (setq rust-mode-treesitter-derive t))
(use-package rustic
  :ensure t
  :delight "R‚úßstic!"
  :after rust-mode
  :custom
  (rustic-cargo-use-last-stored-arguments t)
  (rustic-format-on-save t)
  :config
  (which-key-add-key-based-replacements "C-c C-c" "Rustic"))
#+end_src
* suit--rustic-lsp-flycheck2
#+name: suit--rustic-lsp-flycheck
#+begin_src emacs-lisp :results silent
(use-package flycheck
  :ensure t
  :hook (after-init . global-flycheck-mode)
  :config
  (keymap-set cfg-hk/craft-map "f" flycheck-command-map)
  (which-key-add-key-based-replacements "C-c !" "Flycheck")
  (which-key-add-key-based-replacements "C-. f" "Flycheck"))
(use-package lsp-mode
  :ensure t
  :commands (lsp lsp-deferred)
  :init
  (setq lsp-keymap-prefix "C-c l")  ;; Or 'C-l', 's-l'
  :hook (rustic-mode . lsp-deferred)
  :config
  (lsp-enable-which-key-integration t))
(use-package lsp-treemacs
  :ensure t
  ;; :requires (lsp-mode treemacs)
  :after lsp)
(use-package lsp-ui
  :ensure t
  ;; (:requires lsp-mode)
  :hook (lsp-mode . lsp-ui-mode))
(use-package rustic
  :ensure t
  :delight "R‚úßstic!"
  :custom
  (rustic-cargo-use-last-stored-arguments t)
  (rustic-format-on-save t)
  :config
  (which-key-add-key-based-replacements "C-c C-c" "Rustic"))
#+end_src
* suit--experimental
#+name: suit--experimental
#+begin_src emacs-lisp :results silent
(setq winner-ring-size 10)              ; default 200
#+end_src
* =Modes=
* mode--killless-mode
#+name: mode--killless-mode
#+begin_src emacs-lisp
;;;
;;; killless-mode
;;;
(defvar backup-confirm-pred nil "Backup for `confirm-kill-emacs' variable.")
(define-minor-mode killless-mode
  "Minor mode for prevent Emacs from accidentally closing."
  :init-value nil
  :global t
  :lighter " ‚õ®" ; " LLL"

  (if killless-mode
      (progn
        (setq backup-confirm-pred (eval (car (get 'confirm-kill-emacs 'customized-value))))
        (setq confirm-kill-emacs (lambda (&rest args)
                                         (progn
                                           (message "Realy? Emacs is killless!")
                                           nil)))
        (message "killless ON")
        nil)
    (setq confirm-kill-emacs backup-confirm-pred)
    (setq backup-confirm-pred nil)
    (message "killless OFF")
    nil)
  )
#+end_src
* mode--emax-hk-mode
#+name: mode--emax-hk-mode
#+begin_src emacs-lisp :results silent
;;;
;;; emax-hk-mode
;;;
(defvar-keymap emax-hk-mode-map
  :doc "Keymap for emax hotkeys mode."
  :name "name-of-hk-map"
  :prefix 'emax-hk-mode-map-prefix
  "M-j" #'execute-extended-command
  "C-j" #'Control-X-prefix
  "C-;" #'cfg-hk/agile-map-prefix
  "C-." #'cfg-hk/craft-map-prefix
  "<f12>" #'cfg-hk/major-map-prefix)
;; (defcustom emax-hk-translate-keys nil
;;   "Hide the comments too when you do an `hs-hide-all'."
;;   :type 'boolean
;;   :set )
(define-minor-mode emax-hk-mode
  "Minor mode with my emax hotkeys."
  :global t
  :lighter " ‚åò" ; üõ†‚úß‚ú≤
  :keymap emax-hk-mode-map
  (if emax-hk-mode
      (progn
        ;; (keymap-set key-translation-map "C-j" "C-x")
        ;; (keymap-set key-translation-map "M-j" "M-x")
        (unless (display-graphic-p)
;;; <C-;> && <C-'> && <C-,> don't working in terminal
;;; <C-/> readed like <C-_>
          (keymap-set key-translation-map ";" "C-;")
          (keymap-set key-translation-map "C-x ;" ";")
          (keymap-set key-translation-map "C-_" "C-/")))
    ;; (keymap-unset key-translation-map "C-j")
    ;; (keymap-unset key-translation-map "M-j")
    (unless (display-graphic-p)
      (keymap-unset key-translation-map ";")
      (keymap-unset key-translation-map "C-x ;")
      (keymap-unset key-translation-map "C-_"))
    ))
#+end_src
* =--Keybindings---------------------------=
* bind--override-standard
#+name: bind--override-standard
#+begin_src emacs-lisp :results silent
(keymap-global-unset "C-x C-c")       ; save-buffers-kill-terminal
(keymap-global-set "C-x x c" 'save-buffers-kill-terminal) ; close emacs
;; (keymap-global-set "C-x C-c" (lambda () (interactive) (message "<C-x C-c> rebind to <C-x x c>")))
(keymap-global-set "C-x C-c" 'kmacro-keymap) ; release <C-x C-k>
(keymap-global-set "C-x C-k" 'kill-current-buffer) ;
;;; <C-;> && <C-'> && <C-,> don't working in terminal
;;; <C-/> readed like <C-_>
(keymap-global-unset "C-z")         ; suspend-frame + <C-x C-z>
(keymap-global-unset "C-?")         ; undo-redo == <C-S-z> + <C-M-_>
(keymap-global-unset "C-/")         ; undo == <C-z> + <C-_>
(keymap-global-unset "M-/")         ; dabbrev-expand
(keymap-global-unset "C-x ;")       ; comment-set-column
(keymap-global-unset "C-x C-;")     ; comment-line == <C-/>
(keymap-global-unset "M-;")         ; comment-dwim == <M-/>
(keymap-global-set "C-z" 'undo)     ;
(keymap-global-set "C-S-z" 'undo-redo)  ; also <C-M-_> (in terminal)
(keymap-global-set "C-/" 'comment-line) ; short comment line
(keymap-global-set "M-/" 'comment-dwim) ; comment endline
(keymap-global-set "M-;" 'dabbrev-expand) ; expand previous word "dynamically"

(keymap-global-set "C-x !" 'shrink-window)
#+end_src
* bind--agile-map
#+name: bind--agile-map
#+begin_src emacs-lisp :results silent
;; Emax minor keymap
(defvar-keymap cfg-hk/agile-map
  :doc "My minor menu on short hand."
  :prefix 'cfg-hk/agile-map-prefix
  "s" '("tab switcher" . tab-switcher)
  "t" '("treemacs" . treemacs)
  "C-e" '("w-right" . windmove-right)
  "C-f" '("w-right" . windmove-right)
  "C-a" '("w-left" . windmove-left)
  "C-b" '("w-left" . windmove-left)
  "C-p" '("w-up" . windmove-up)
  "C-n" '("w-down" . windmove-down))
#+end_src
* bind--craft-map
#+name: bind--craft-map
#+begin_src emacs-lisp :results silent
;; Emax craft keymap
(defvar-keymap cfg-hk/craft-map
  :doc "My craft menu on short hand."
  :prefix 'cfg-hk/craft-map-prefix
  "?" '("help" . (lambda () (interactive) (find-file (cfg/path-s "jotting.org"))))
  )
#+end_src
* bind--major-map
#+name: bind--major-map
#+begin_src emacs-lisp :results silent
;; Emax major keymap
(defvar-keymap cfg-hk/major-map
  :doc "My main menu on long hand."
  :prefix 'cfg-hk/major-map-prefix
  "c" `("configure" . cfg-hk/open-config-map-prefix)
  "o" `("open" . cfg-hk/open-entities-map-prefix)
  ;; "r" `("run". cfg-hk/run-commands-map-prefix)
  "u" `("ui" . cfg-hk/update-ui-map-prefix)
  "k" '("kill less" . killless-mode)
  "C-c" '("close emacs" .  save-buffers-kill-terminal)
  "<f12>" `("shelf" . cfg-hk/open-shelf-map-prefix))
#+end_src
* bind--minor-maps
#+name: bind--minor-maps
#+begin_src emacs-lisp :results silent
(defvar-keymap cfg-hk/open-config-map
  :doc "Config"
  :prefix 'cfg-hk/open-config-map-prefix
  "1" '("Config" . (lambda () (interactive) (find-file (cfg/path "Config.org"))))
  ;; "1" '("Config" . (i-event (find-file (cfg/path "Config.org"))))
  "2" '("Cfg directory" . (lambda () (interactive) (project-switch-project (cfg/path ""))))
  "3" '("Emacs early-init.el" . (lambda () (interactive) (find-file early-init-file)))
  "4" '("Emacs init.el" . (lambda () (interactive) (find-file user-init-file)))
  "5" '("Emacs custom-file" . (lambda () (interactive)
                                (if (file-exists-p custom-file)
                                   (find-file custom-file)
                                  (message (format "file '%s' does not exist" custom-file)))))
  "6" '("Emacs user dir" . (lambda () (interactive) (find-file user-emacs-directory)))
  "Y" '("Yard directory" . (lambda () (interactive) (find-file (cfg/yard))))
  "y" '("Yard config" . (lambda () (interactive) (find-file (cfg/yard "yard.org"))))
  )
(defvar-keymap cfg-hk/open-entities-map
  :doc "Open frequently used entities."
  :prefix 'cfg-hk/open-entities-map-prefix
  "r" '("open recents" . recentf-open)
  )
(defvar-keymap cfg-hk/open-shelf-map
  :doc "Open user shelf."
  :prefix 'cfg-hk/open-shelf-map-prefix
  "I" `("roam index" . (lambda ()(interactive) (find-file (cfg/org "index.org"))))
  "M" `("math" . (lambda ()(interactive) (find-file (cfg/org "math.org"))))
  "<f12>" `("–ó–∞–º–µ—Ç–∫–∏" . (lambda ()(interactive) (find-file (cfg/path-s "help-daily.org")))))
(defvar-keymap cfg-hk/run-commands-map
  :doc "Run external commands."
  :prefix 'cfg-hk/run-commands-map-prefix
  ;; "a" `("emaxa" . (lambda () (interactive) (make-process :name "Emacs Air" :command "emaxa")))
  )
(defvar-keymap cfg-hk/update-ui-map
  :doc "View changes."
  :prefix 'cfg-hk/update-ui-map-prefix
  "t" '("switch theme" . cfg/switch-theme))

#+end_src
* bind--hydra-hotkeys
/The keys are bind when the *hidra* package included/ [[*pckg--hydra]]
#+name: bind--hydra-hotkeys
#+begin_src emacs-lisp :noweb yes :results silent
<<bind--hydra-toggle-mode>>
<<bind--hydra-change-windows>>
<<bind--hydra-games>>
<<bind--hydra-misc>>

(keymap-set cfg-hk/update-ui-map "C-t" '("text scale" . hydra--text-scale/body))
(keymap-set cfg-hk/update-ui-map "w" '("window move" . hydra--window-move/body))
(keymap-set cfg-hk/major-map "g" '("games" . hydra--play-games/body))
(keymap-set cfg-hk/major-map "t" '("toggle" . hydra--toggle-mode/body))

(keymap-global-set "M-O" 'hydra--window-move/body); window move
#+end_src
** bind--hydra-toggle-mode
#+name: bind--hydra-toggle-mode
#+begin_src emacs-lisp :results silent
(defhydra hydra--toggle-mode (:hint nil)
  "
  ^
  ^Toggle^   ^Emacs^              ^Ui^               ^Editor^
  ^------^---^-----^--------------^--^---------------^------^---
  _q_ quit   _h_ highlight line   _f_ fontaine       _m_ menu
  ^^         _l_ long line wrap   _g_ golden ratio   _t_ treemacs
  ^^         _w_ whitespaces      _o_ org modern     _T_ tab headers
  _B_ ‚åò   ^^                      _p_ paddings       _W_ Win tabs
  _k_ LLL ^^                      _V_ V. posframe
  "
  ("q" nil)

  ("h" hl-line-mode)
  ("l" visual-line-mode)
  ("w" whitespace-mode)

  ;; ("f" fontaine-set-preset)
  ("f" fontaine-mode)
  ("g" golden-ratio-mode)
  ("o" org-modern-mode)
  ("p" spacious-padding-mode)
  ("V" vertico-multiform-mode)

  ("m" menu-bar-mode)
  ("t" treemacs)
  ("T" cfg/toggle-tab-bar-headers-visible)
  ("W" tab-line-mode)

  ("B" emax-hk-mode)
  ("k" killless-mode))
#+end_src
** bind--hydra-change-windows
#+name: bind--hydra-change-windows :results silent
#+begin_src emacs-lisp
(defhydra hydra--text-scale(:timeout 10)
  "scale text"
  ("i" text-scale-increase "in")
  ("k" text-scale-decrease "out")
  ("q" nil "finished", :exit t))
(defhydra hydra--window-move(:hint nil)
  "
  ^Window^   ^Manual^         ^Auto^             ^Navigation^
  ^------^---^------^---------^----^-------------^----------^^^^^^-
  _q_ quit   _I_ ‚Üë increase   _-_ by buffer      ^    _p_
  ^^         _K_ ‚Üì decrease   _+_ balance          _a_ ‚ú¶ _f_
  ^^         _J_ ‚Üí shrink ‚Üê   _g_ golden ratio   ^    _n_
  ^^         _L_ ‚Üê expand ‚Üí   ^^                 ^----------^^^^^^-
  "
  ("I" enlarge-window nil)
  ("K" shrink-window nil)
  ("J" shrink-window-horizontally nil)
  ("L" enlarge-window-horizontally nil)
  ("-" shrink-window-if-larger-than-buffer nil)
  ("+" balance-windows nil)
  ("=" balance-windows nil)
  ("g" golden-ratio)
  ("a" windmove-left nil)
  ("b" windmove-left nil)
  ("p" windmove-up nil)
  ("n" windmove-down nil)
  ("f" windmove-right nil)
  ("e" windmove-right nil)
  ("C-a" windmove-left nil)
  ("C-b" windmove-left nil)
  ("C-p" windmove-up nil)
  ("C-n" windmove-down nil)
  ("C-f" windmove-right nil)
  ("C-e" windmove-right nil)
  ("q" nil)
  )
#+end_src

#+RESULTS: bind--hydra-change-windows
: hydra--window-move/body

** bind--hydra-games
#+name: bind--hydra-games
#+begin_src emacs-lisp :results silent
(defhydra hydra--play-games (:hint nil :color blue)
  "
  ^
    ^Games
    ^-------------
    _!_ happy birthday
    _D_ dunnet
    _g_ gomoku
    _l_ life
    _m_ mines
    _M_ mpuz
    _s_ snake
    _t_ solitaire
    _z_ zone
    _d_ doctor

    _q_ quit
    ^-------------
    "
  ("!" animate-birthday-presint)
  ("D" dunnet)
  ("g" gomoku)
  ("l" life)
  ("m" mines)
  ("M" mpuz)
  ("s" snake)
  ("t" solitaire)
  ("z" zone)
  ("d" doctor)
  ("q" nil :color pink)
)
#+end_src
** bind--hydra-misc
#+name: bind--hydra-misc
#+begin_src emacs-lisp :results silent
(defhydra hydra-helper--buf-move()
  "move buffer"
  ("s" buf-move-left "left")
  ("e" buf-move-up "up")
  ("d" buf-move-down "down")
  ("f" buf-move-right "right")
  ("SPC" nil "finished", :exit t))
#+end_src
* =--Emacs-customization-------------------=
* cstm--user-env
#+name: cstm--user-env
#+begin_src emacs-lisp :results silent
(defun cfg/yard (&optional arg) (expand-file-name (or arg "") "~/sync/yard"))
(defun cfg/shelf (&optional arg) (expand-file-name (or arg "") "~/sync/shelf"))
(defun cfg/org (&optional arg) (expand-file-name (or arg "") "~/sync/shelf/org-arium"))
(custom-set-variables
 '(calendar-date-style 'european)
 '(diary-file (cfg/shelf "diary")))
#+end_src
* cstm--default
#+name: cstm--default
#+begin_src emacs-lisp :results silent
;;;;; visibility
(custom-set-variables
 '(blink-cursor-blinks 3600)   ; –≤—Ä–µ–º—è –º–∏–≥–∞–Ω–∏—è –∫—É—Ä—Å–æ—Ä–∞ –ø—Ä–∏ –±–µ–∑–¥–µ–π—Å—Ç–≤–∏–∏
 '(column-number-mode t)
 '(display-line-numbers 'relative)
 '(fringe-mode 8 nil (fringe))
 '(hl-line-mode t)                 ; –ø–æ–¥—Å–≤–µ—Ç–∫–∞ —Ç–µ–∫—É—â–µ–π —Å—Ç—Ä–æ–∫–∏
 '(inhibit-startup-screen t)
 '(menu-bar-mode nil)
 '(scroll-bar-mode nil)
 '(scroll-step 1)
 '(tab-bar-mode t)                      ; using tab bars
 '(tab-bar-show 100)                    ; hide if tabs less 100
 '(tool-bar-mode nil)
 '(visible-bell t))                ; –º–∏–≥–∞–Ω–∏–µ –µ—Å–ª–∏ –¥–µ–π—Å—Ç–≤–∏–µ –Ω–µ –¥–æ—Å—Ç—É–ø–Ω–æ
;;;;; saving additional information
(custom-set-variables
 '(auto-save-default nil)
 '(auto-save-list-file-prefix (cfg/path-u "tmp-auto-save-list/.saves-"))
 '(create-lockfiles nil)
 '(make-backup-files nil)
 ;; '(project-list-file (cfg/path-u "projects"))
 '(recentf-mode t) ; use the M-x recentf-open-files command
 ;; '(recentf-save-file (cfg/path-u "recentf"))
 '(savehist-mode t)      ; history
 '(history-length 25)    ; save what you enter into minibuffer prompts
 '(history-delete-duplicates t)
 ;; '(savehist-file (cfg/path-u "history"))
 '(save-place-mode t) ; remember and restore the last cursor location of opened files
 )
;;;;; behaviour
(custom-set-variables
 '(auto-revert-mode t)                  ; —Ä–µ–∂–∏–º –∞–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –±—É—Ñ–µ—Ä–∞
 '(auto-revert-interval 1)
 '(delete-selection-mode t)
 ;; '(global-auto-revert-mode t) ; autoreload file from disk if changed
 '(global-auto-revert-non-file-buffers t)
 '(require-final-newline t)
 '(truncate-lines t)
 '(use-short-answers t))
;;;;; tabs
(custom-set-variables
 '(indent-tabs-mode nil)
 '(c-tab-always-indent t)
 '(tab-always-indent t)
 '(tab-width 4))
;;;;; C/C++ mode
(c-add-style "main" '("gnu" (c-basic-offset . 4)))
(customize-set-variable 'c-default-style
                        '((java-mode . "java") (awk-mode . "awk")
                          (other . "main")))
#+end_src
* cstm--electric-pairs
#+name: cstm--electric-pairs
#+begin_src emacs-lisp
;;;;; electric-pairs
(custom-set-variables
 '(electric-pair-mode t)
 '(electric-pair-pairs
   '((34 . 34)
     (8216 . 8217)
     (8220 . 8221)
     ;; (39 . 39) ;; ''
     (96 . 96)
     (40 . 41)
     (91 . 93)
     (123 . 125)))
 '(electric-pair-text-pairs
   '((34 . 34)
     (8216 . 8217)
     (8220 . 8221)
     ;; (39 . 39) ;; ''
     (96 . 96)
     (40 . 41)
     (91 . 93)
     (123 . 125))))
#+end_src
* thms--initialize
#+name: thms--initialize
#+begin_src emacs-lisp :results silent
;;;
;;; thms--initialize
;;;
(defvar cfg/available-theme-tags '(None Craft Night Paper Retro)
  "List of available tags of themes.")
(defvar cfg/theme-profile-tags '((actual . Night)
                                 (built-in . wombat)
                                 (craft . Craft)
                                 (devel . None))
  "Table for selecting a theme by profile.")
(defvar cfg/theme-tags '((Craft . misterioso)
                         (Night . tango-dark)
                         (Paper . adwaita)
                         (Retro . deeper-blue))
  "Table for selecting a theme by tag.")
(defun cfg/switch-theme (theme &optional no-confirm no-enable)
  "Wrapper for `load-theme', load theme ARG."
  (interactive
   (list
    (intern (completing-read "Load custom theme: "
                             (mapcar #'symbol-name
				                     (append cfg/available-theme-tags
                                             (custom-available-themes)))))
    nil nil))
  (mapcar #'disable-theme custom-enabled-themes)
  (unless (eq 'None theme)
    (load-theme (or (alist-get theme cfg/theme-tags) theme) no-confirm no-enable)))
;; override theme tags
(when (and (member cfg/profile '(actual craft)) (package-installed-p 'ef-themes))
  (setq cfg/theme-tags '((Craft . ef-maris-dark)
                         (Night . ef-night)
                         (Paper . ef-cyprus)
                         (Retro . ef-bio))))
;; load theme
(cfg/switch-theme (intern-soft (or (getenv "EMAX_THM")
                                   (alist-get cfg/profile cfg/theme-profile-tags)
                                   'None)) t)
#+end_src
* =----------------------------------------=
* code--emacs-improvies
#+name: code--emacs-improvies
#+begin_src emacs-lisp
;;;
;;; Emacs improvies
;;;
(defun em-im-move-prev-line (n)
  "Move cursor to N previous lines and scrol down N lines."
  (interactive "p")
  (or n (setq n 1))
  (setq n (* n next-screen-context-lines))
  (scroll-down-line n)
  (previous-line n)
  )
(defun em-im-move-next-line (n)
  "Move cursor to N next lines and scrol up N lines."
  (interactive "p")
  (or n (setq n 1))
  (setq n (* n next-screen-context-lines))
  (scroll-up-line n)
  (next-line n)
  )
(defmacro i-event (func arg)
  "Returns an anonymous function that calls the FUNC with an argument ARG."
  `(lambda () (interactive) (,func ,arg)))
#+end_src
* code--jobs
#+name: code--jobs
#+begin_src emacs-lisp
(defun u--do-prepare-job-assist ()
  "Prepare Emacs for job assistent."
  (global-visual-line-mode 1)
  (tab-rename "tasks")
  (find-file (expand-file-name "agenda/agenda.org" org-directory))
  (split-window-vertically -10)
  (other-window 1)
  (org-agenda-list)
  (split-window-vertically -6)
  (other-window 1)
  (tmr-tabulated-view)
  (other-window 1)
  (tab-bar-new-tab)
  ;; (tab-bar-switch-to-next-tab)
  (find-file (expand-file-name "assist/main.org" org-directory))
  (split-window-vertically -10)
  (other-window 1)
  (find-file (expand-file-name "assist/day-book.org" org-directory))
  (other-window 1)
  ;; (tab-bar-switch-to-next-tab)
  (tab-next)
  (cfg/toggle-tab-bar-headers-visible 0)
  (killless-mode t)
  )
#+end_src
* --unused
** pckg--smartparens-xclip
#+name: pckg--smartparens
#+begin_src emacs-lisp :results silent
(use-package smartparens
  :hook (prog-mode text-mode) ;; add `smartparens-mode` to these hooks
  :config
  ;; load default config
  (require 'smartparens-config))
(use-package xclip ; copy/paste in terminal
  :ensure t
  :pin gnu
  :unless (display-graphic-p)
  :config (xclip-mode 1))
#+end_src
** pckg--flycheck-eglot
#+name: pckg--flycheck-eglot
#+begin_src emacs-lisp :results silent
(use-package flycheck-eglot
  :disabled
  :requires flycheck
  :after (eglot flycheck)
  :config
  (global-flycheck-eglot-mode 1))
#+end_src
** pckg--gt TODO: tune backend
#+name: pckg--gt
#+begin_src emacs-lisp
(use-package gt ; language translator
  :disabled
  :config
  (setq gt-langs '(en ru))
  ;; (setq gt-default-translator (gt-translator :engines (gt-google-engine)))
  ;; (setq gt-default-translator (gt-translator :engines (gt-bing-engine)))
  (setq gt-default-translator (gt-translator :engines (gt-stardict-engine)))
 )
#+end_src

** pckg--projectile
#+name: pckg--projectile
#+begin_src emacs-lisp
(use-package projectile
  :disabled
  :bind
  ("C-x p" . projectile-command-map)
  ;; :custom
  ;; (projectile-completion-system 'ivy)
  :config
  (projectile-mode 1)
  (when (and *sys/win32*
             (executable-find "tr"))
    (setq projectile-indexing-method 'alien))
  (add-to-list 'projectile-globally-ignored-directories "node_modules"))
#+end_src

** pckg--rust-mode
#+name: pckg--rust-mode
#+begin_src emacs-lisp
(use-package rust-mode ; https://elpa.nongnu.org/nongnu/rust-mode.html
  :mode ("\\.rs\\'" . rust-mode)
  ;; :hook (rust-mode . eglot-ensure)
  ;; :config
  ;; (let ((dot-cargo-bin (expand-file-name "~/.cargo/bin/")))
    ;; (setq rust-rustfmt-bin (concat dot-cargo-bin "rustfmt")
          ;; rust-cargo-bin (concat dot-cargo-bin "cargo")
          ;; rust-format-on-save t))
  :custom
  (rust-format-on-save t))
#+end_src
** pckg--rustic
#+name: pckg--rustic
#+begin_src emacs-lisp :results silent
(use-package rustic
  :ensure t
  :delight "R‚úßstic"
  ;; :mode ((rx ".rs" string-end) . rustic-mode)
  :init
  ;; (setq rustic-lsp-setup-p nil)
  ;; (setq rustic-lsp-client 'eglot)
  :custom
  (rustic-cargo-use-last-stored-arguments t)
  (rustic-format-on-save t)
  :config
  (which-key-add-key-based-replacements "C-c C-c" "Rustic"))
(use-package flymake-clippy
  :ensure t
  :pin gnu
  :after (rustic flymake)
  :hook (rustic-mode . flymake-clippy-setup)
  :config (add-hook 'rustic-mode-hook #'flymake-mode))
#+end_src
** pckg--rust-ext
#+name: pckg--rust-ext
#+begin_src emacs-lisp :results silent
(use-package flymake-clippy
  :hook
  (rust-ts-mode . flymake-mode)
  (rust-ts-mode . flymake-clippy-setup))
(use-package cargo-mode
  :delight "C‚úßrgo"
  :mode "Cargo.toml\\'"
  :hook (rust-ts-mode . cargo-minor-mode)
  :custom
  (compilation-scroll-output t))
#+end_src
** pckg--vterm
#+name: pckg--vterm
#+begin_src emacs-lisp :results silent
(use-package vterm
  :disabled
  :commands vterm
  :config
  ;; (setq term-prompt-regexp "^[^#$%>\n]*[#$%>] *")  ;; Set this to match your custom shell prompt
  ;;(setq vterm-shell "zsh")                       ;; Set this to customize the shell to launch
  (setq vterm-max-scrollback 10000))
#+end_src
** pckg--pdf-djvu
#+name: pckg--pdf-djvu
#+begin_src emacs-lisp :results silent
(use-package djvu
  :ensure t
  :pin gnu)
(use-package pdf-tools
  :ensure t
  :pin nongnu)
#+end_src
* =----------------------------------------=
* data--copyright
#+name: data--copyright
#+begin_src emacs-lisp

;; WARNING: this script generated form Config.org file.
;; Copyright (c) 2024-2026 Sergey Egorov
;; Author: Segey Egorov <esedev@gmail.com>
;; Keywords: config emacs
;; Version: 0.3.0
;; Package-Requires: ((emacs "30"))
;; Created: May 2024
;; URL:
;; Repository:

#+end_src
* data--license-gpl-v3
#+name: data--license-gpl-v3
#+begin_src emacs-lisp
;;; License:
;;
;; This program is free software; you can redistribute it and/or modify
;; it under the terms of the GNU General Public License as published by
;; the Free Software Foundation, either version 3 of the License, or
;; (at your option) any later version.
;;
;; This program is distributed in the hope that it will be useful,
;; but WITHOUT ANY WARRANTY; without even the implied warranty of
;; MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
;; GNU General Public License for more details.
;;
;; You should have received a copy of the GNU General Public License
;; along with this program.  If not, see <http://www.gnu.org/licenses/>.

#+end_src
* data--early-init-comment
#+name: data--early-init-comment
#+begin_src emacs-lisp :results silent

;; This file performs initial configuration initialization.
;; It's a good place to set up debugging options.

;; 1. Additional command line arguments starting with the
;;   --u-%name% prefix are processed. The values of these options
;;   ‚Äã‚Äãwill be written to environment variables named EMAX_%NAME%.
;;   The current configuration uses the following environment variables:
;;   EMAX_PRF - Determines which initialization file will be loaded
;;   EMAX_THM - Overrides the Emacs color theme
;;   EMAX_JOB - A job script to run when Emacs starts
;;   example:  emacs --u-prf=devel --u-thm=wombat
;;             equivalent to the startup command
;;             env EMAX_PRF=devel EMAX_THM=wombat emacs

;; 2. Global variables that have values ‚Äã‚Äãfor configuration settings are initialized
;;   cfg/profile - specifies which startup script will be used.
;;   Possible values: actual(default), built-in, craft, devel.

;; 3. Setting up paths, keep the configuration directory clean and tidy.
;;   Functions that return paths to configuration files are defined
;;   to ensure the configuration directory is kept in order.

;; 4. Tuning of performance

#+end_src
* =----------------------------------------=
